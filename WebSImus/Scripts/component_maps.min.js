function addGoogleUtils() { google.maps.Polygon.prototype.getBounds = function () { for (var e, t = new google.maps.LatLngBounds, o = this.getPaths(), n = 0; n < o.getLength(); n++) { e = o.getAt(n); for (var i = 0; i < e.getLength(); i++)t.extend(e.getAt(i)) } return t }, google.maps.Polyline.prototype.getBounds = function () { var e = new google.maps.LatLngBounds, t = this.getPath(); return t.forEach(function (t, o) { e.extend(t) }), e } } function dispatchCustomEvent(e, t) { obj = { detail: {} }, t || (t = obj), $.event.trigger({ type: e, detail: t.detail }) } function JSONToCSVConvertor(e, t, o) { var n = "object" != typeof e ? JSON.parse(e) : e, i = ""; if (i += t + "\r\n\n", o) { var a = ""; for (var r in n[0]) a += r + ";"; a = a.slice(0, -1), i += a + "\r\n" } for (var s = 0; s < n.length; s++) { var a = ""; for (var r in n[s]) a += '"' + n[s][r] + '";'; a.slice(0, a.length - 1), i += a + "\r\n" } if ("" == i) return void alert("Invalid data"); var l = "MyReport_"; l += t.replace(/ /g, "_"); var c = "data:text/csv;charset=utf-8," + escape(i), p = document.createElement("a"); p.href = c, p.style = "visibility:hidden", p.download = l + ".csv", document.body.appendChild(p), p.click(), document.body.removeChild(p) } String.prototype.format = function () { for (var e = this, t = 0; t < arguments.length; t++) { var o = new RegExp("\\{" + t + "\\}", "g"); e = e.replace(o, arguments[t]) } return e }, String.prototype.trim = function () { return this.replace(/^\s+|\s+$/g, "") }, String.prototype.ltrim = function () { return this.replace(/^\s+/, "") }, String.prototype.rtrim = function () { return this.replace(/\s+$/, "") }, String.prototype.fulltrim = function () { return this.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g, "").replace(/\s+/g, " ") }, String.prototype.reverse = function () { for (var e = this.length, t = ""; --e >= 0;)t += this.charAt(e); return t }, String.prototype.replaceAll = function (e, t) { var o = this; return o.split(e).join(t) }, File.prototype.convertToBase64 = function (e) { var t = new FileReader; t.onload = function (t) { e(t.target.result) }, t.readAsDataURL(this) }, window.google && addGoogleUtils(), MD5 = function (e) { function t(e, t) { return e << t | e >>> 32 - t } function o(e, t) { var o, n, i, a, r; return i = 2147483648 & e, a = 2147483648 & t, o = 1073741824 & e, n = 1073741824 & t, r = (1073741823 & e) + (1073741823 & t), o & n ? 2147483648 ^ r ^ i ^ a : o | n ? 1073741824 & r ? 3221225472 ^ r ^ i ^ a : 1073741824 ^ r ^ i ^ a : r ^ i ^ a } function n(e, t, o) { return e & t | ~e & o } function i(e, t, o) { return e & o | t & ~o } function a(e, t, o) { return e ^ t ^ o } function r(e, t, o) { return t ^ (e | ~o) } function s(e, i, a, r, s, l, c) { return e = o(e, o(o(n(i, a, r), s), c)), o(t(e, l), i) } function l(e, n, a, r, s, l, c) { return e = o(e, o(o(i(n, a, r), s), c)), o(t(e, l), n) } function c(e, n, i, r, s, l, c) { return e = o(e, o(o(a(n, i, r), s), c)), o(t(e, l), n) } function p(e, n, i, a, s, l, c) { return e = o(e, o(o(r(n, i, a), s), c)), o(t(e, l), n) } function u(e) { for (var t, o = e.length, n = o + 8, i = (n - n % 64) / 64, a = 16 * (i + 1), r = Array(a - 1), s = 0, l = 0; l < o;)t = (l - l % 4) / 4, s = l % 4 * 8, r[t] = r[t] | e.charCodeAt(l) << s, l++; return t = (l - l % 4) / 4, s = l % 4 * 8, r[t] = r[t] | 128 << s, r[a - 2] = o << 3, r[a - 1] = o >>> 29, r } function f(e) { var t, o, n = "", i = ""; for (o = 0; o <= 3; o++)t = e >>> 8 * o & 255, i = "0" + t.toString(16), n += i.substr(i.length - 2, 2); return n } function d(e) { e = e.replace(/\r\n/g, "\n"); for (var t = "", o = 0; o < e.length; o++) { var n = e.charCodeAt(o); n < 128 ? t += String.fromCharCode(n) : n > 127 && n < 2048 ? (t += String.fromCharCode(n >> 6 | 192), t += String.fromCharCode(63 & n | 128)) : (t += String.fromCharCode(n >> 12 | 224), t += String.fromCharCode(n >> 6 & 63 | 128), t += String.fromCharCode(63 & n | 128)) } return t } var g, m, v, y, h, w, _, C, T, L = Array(), E = 7, O = 12, M = 17, S = 22, N = 5, b = 9, A = 14, I = 20, k = 4, P = 11, R = 16, D = 23, G = 6, F = 10, V = 15, x = 21; for (e = d(e), L = u(e), w = 1732584193, _ = 4023233417, C = 2562383102, T = 271733878, g = 0; g < L.length; g += 16)m = w, v = _, y = C, h = T, w = s(w, _, C, T, L[g + 0], E, 3614090360), T = s(T, w, _, C, L[g + 1], O, 3905402710), C = s(C, T, w, _, L[g + 2], M, 606105819), _ = s(_, C, T, w, L[g + 3], S, 3250441966), w = s(w, _, C, T, L[g + 4], E, 4118548399), T = s(T, w, _, C, L[g + 5], O, 1200080426), C = s(C, T, w, _, L[g + 6], M, 2821735955), _ = s(_, C, T, w, L[g + 7], S, 4249261313), w = s(w, _, C, T, L[g + 8], E, 1770035416), T = s(T, w, _, C, L[g + 9], O, 2336552879), C = s(C, T, w, _, L[g + 10], M, 4294925233), _ = s(_, C, T, w, L[g + 11], S, 2304563134), w = s(w, _, C, T, L[g + 12], E, 1804603682), T = s(T, w, _, C, L[g + 13], O, 4254626195), C = s(C, T, w, _, L[g + 14], M, 2792965006), _ = s(_, C, T, w, L[g + 15], S, 1236535329), w = l(w, _, C, T, L[g + 1], N, 4129170786), T = l(T, w, _, C, L[g + 6], b, 3225465664), C = l(C, T, w, _, L[g + 11], A, 643717713), _ = l(_, C, T, w, L[g + 0], I, 3921069994), w = l(w, _, C, T, L[g + 5], N, 3593408605), T = l(T, w, _, C, L[g + 10], b, 38016083), C = l(C, T, w, _, L[g + 15], A, 3634488961), _ = l(_, C, T, w, L[g + 4], I, 3889429448), w = l(w, _, C, T, L[g + 9], N, 568446438), T = l(T, w, _, C, L[g + 14], b, 3275163606), C = l(C, T, w, _, L[g + 3], A, 4107603335), _ = l(_, C, T, w, L[g + 8], I, 1163531501), w = l(w, _, C, T, L[g + 13], N, 2850285829), T = l(T, w, _, C, L[g + 2], b, 4243563512), C = l(C, T, w, _, L[g + 7], A, 1735328473), _ = l(_, C, T, w, L[g + 12], I, 2368359562), w = c(w, _, C, T, L[g + 5], k, 4294588738), T = c(T, w, _, C, L[g + 8], P, 2272392833), C = c(C, T, w, _, L[g + 11], R, 1839030562), _ = c(_, C, T, w, L[g + 14], D, 4259657740), w = c(w, _, C, T, L[g + 1], k, 2763975236), T = c(T, w, _, C, L[g + 4], P, 1272893353), C = c(C, T, w, _, L[g + 7], R, 4139469664), _ = c(_, C, T, w, L[g + 10], D, 3200236656), w = c(w, _, C, T, L[g + 13], k, 681279174), T = c(T, w, _, C, L[g + 0], P, 3936430074), C = c(C, T, w, _, L[g + 3], R, 3572445317), _ = c(_, C, T, w, L[g + 6], D, 76029189), w = c(w, _, C, T, L[g + 9], k, 3654602809), T = c(T, w, _, C, L[g + 12], P, 3873151461), C = c(C, T, w, _, L[g + 15], R, 530742520), _ = c(_, C, T, w, L[g + 2], D, 3299628645), w = p(w, _, C, T, L[g + 0], G, 4096336452), T = p(T, w, _, C, L[g + 7], F, 1126891415), C = p(C, T, w, _, L[g + 14], V, 2878612391), _ = p(_, C, T, w, L[g + 5], x, 4237533241), w = p(w, _, C, T, L[g + 12], G, 1700485571), T = p(T, w, _, C, L[g + 3], F, 2399980690), C = p(C, T, w, _, L[g + 10], V, 4293915773), _ = p(_, C, T, w, L[g + 1], x, 2240044497), w = p(w, _, C, T, L[g + 8], G, 1873313359), T = p(T, w, _, C, L[g + 15], F, 4264355552), C = p(C, T, w, _, L[g + 6], V, 2734768916), _ = p(_, C, T, w, L[g + 13], x, 1309151649), w = p(w, _, C, T, L[g + 4], G, 4149444226), T = p(T, w, _, C, L[g + 11], F, 3174756917), C = p(C, T, w, _, L[g + 2], V, 718787259), _ = p(_, C, T, w, L[g + 9], x, 3951481745), w = o(w, m), _ = o(_, v), C = o(C, y), T = o(T, h); var j = f(w) + f(_) + f(C) + f(T); return j.toLowerCase() }, utf8_encode = function (e) { if (null === e || "undefined" == typeof e) return ""; var t, o, n = e + "", i = "", a = 0; t = o = 0, a = n.length; for (var r = 0; r < a; r++) { var s = n.charCodeAt(r), l = null; if (s < 128) o++; else if (s > 127 && s < 2048) l = String.fromCharCode(s >> 6 | 192, 63 & s | 128); else if (55296 != (63488 & s)) l = String.fromCharCode(s >> 12 | 224, s >> 6 & 63 | 128, 63 & s | 128); else { if (55296 != (64512 & s)) throw new RangeError("Unmatched trail surrogate at " + r); var c = n.charCodeAt(++r); if (56320 != (64512 & c)) throw new RangeError("Unmatched lead surrogate at " + (r - 1)); s = ((1023 & s) << 10) + (1023 & c) + 65536, l = String.fromCharCode(s >> 18 | 240, s >> 12 & 63 | 128, s >> 6 & 63 | 128, 63 & s | 128) } null !== l && (o > t && (i += n.slice(t, o)), i += l, t = o = r + 1) } return o > t && (i += n.slice(t, a)), i }; var QueryString = function () { for (var e = {}, t = window.location.search.substring(1), o = t.split("&"), n = 0; n < o.length; n++) { var i = o[n].split("="); if ("undefined" == typeof e[i[0]]) e[i[0]] = i[1]; else if ("string" == typeof e[i[0]]) { var a = [e[i[0]], i[1]]; e[i[0]] = a } else e[i[0]].push(i[1]) } return e }(); !function () { if ("undefined" == typeof window.jQuery) return void console.error("Es requerida la libreria jQuery"); if ("undefined" == typeof window.Namespace) return void console.error("Es requerida la libreria Namespace"); var e = { libraries_location: "https://mincultura-dot-cdn-components.appspot.com/vendor", gmaps_client: "gme-ministeriodecultura1", gmaps_key: void 0 }; window.ComponentSettings = window.ComponentSettings || {}; var t = $.extend(e, window.ComponentSettings); Namespace("com.servinf"), window.spaceName = "ComponentMaps", Namespace("com.servinf.{0}".format(window.spaceName)), com.servinf.getScripts = function (e, t) { function o() { n -= 1, 0 == n && setTimeout(t, 1e3) } for (var n = e.length, i = 0; i < e.length; i++) { var a = e[i]; $.getScript(a, o) } }, com.servinf.getStyles = function (e, t) { for (var o = 0; o < t.length; o++) { var n = t[o], i = document.createElement("link"); i.setAttribute("rel", "stylesheet"), i.setAttribute("type", "text/css"), i.setAttribute("href", n), e.append(i) } }, com.servinf.dispatchCustomEvent = function (e, t) { obj = { detail: {} }, t || (t = obj), $.event.trigger({ type: e, detail: t.detail }) }, com.servinf.clearSpecialChars = function (e) { for (var t = "ÃƒÃ€ÃÃ„Ã‚ÃˆÃ‰Ã‹ÃŠÃŒÃÃÃŽÃ’Ã“Ã–Ã”Ã™ÃšÃœÃ›Ã£Ã Ã¡Ã¤Ã¢Ã¨Ã©Ã«ÃªÃ¬Ã­Ã¯Ã®Ã²Ã³Ã¶Ã´Ã¹ÃºÃ¼Ã»", o = "AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuu", n = 0; n < t.length; n++)e = e.replace(t.charAt(n), o.charAt(n)); return e }, com.servinf[window.spaceName].Config = { assets: { departments: "https://storage.googleapis.com/cdn-components.appspot.com/json/departamentos.json" }, modules: { VIEWER_DATA: 1, DEPARTMENTS_VIEW: 2, DEPARTMENT_VIEW: 3, FORM_CAPTURE: 4 }, google: { url: "https://maps.googleapis.com/maps/api/js?signed_in=false", libraries: ["drawing", "visualization", "places"], language: "es", client: "gme-ministeriodecultura1", get: function () { var e = this.url; return this.libraries && (e = e + "&libraries=" + this.libraries.join(",")), this.language && (e = e + "&language=" + this.language), this.client && (e = e + "&client=" + this.client), e } }, styles: ["https://fonts.googleapis.com/icon?family=Material+Icons", t.libraries_location + "/jquery-ui-1.12.1.custom/jquery-ui.min.css", "https://fonts.googleapis.com/css?family=Roboto:400,300,500", "https://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css"], scripts: [t.libraries_location + "/jquery-ui-1.12.1.custom/jquery-ui.min.js", t.libraries_location + "/lodash/dist/lodash.min.js", t.libraries_location + "/handlebars/handlebars.min.js", t.libraries_location + "/fancybox/source/jquery.fancybox.pack.js", t.libraries_location + "/es6-promise/es6-promise.min.js"], jsRequired: function () { var e = this.google.get(); return [e, t.libraries_location + "/js-marker-clusterer/src/markerclusterer.js", "https://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"] }, google_maps_lib: "https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=drawing,visualization,places&language=es&client=gme-ministeriodecultura1", init: function () { com.servinf.getStyles($("head"), this.styles), com.servinf.getScripts(this.scripts, function () { console.info("Done"), dispatchCustomEvent("ON_COMPLETE_LOAD_COMPONENT", { detail: {} }) }) } }, $(function () { com.servinf[window.spaceName].Config.init() }) }(), Namespace("com.servinf.geo"), com.servinf.geo.Layer = function (e, t) { var o = this, n = {}; this.getOverlays = function () { return n }, this.getOverlay = function (e) { return n[e] }, this.clearOverlays = function () { for (var e in n) this.removeOverlay(e) }, this.hideOverlay = function (e) { void 0 !== n[e] && null != n[e].getMap() && n[e].setMap(null) }, this.hide = function (e) { if (void 0 != e) Array.isArray(e) && e.forEach(function (e) { o.hideOverlay(e) }); else for (var t in n) this.hideOverlay(t) }, this.showOverlay = function (e) { void 0 !== n[e] && null == n[e].getMap() && n[e].setMap(t) }, this.show = function () { for (var e in n) this.showOverlay(e) }, this.addOverlay = function (e, t) { void 0 !== n[e] && (n[e].setMap(null), delete n[e]), n[e] = t }, this.removeOverlay = function (e) { void 0 !== n[e] && (n[e].setMap(null), delete n[e]) }, this.forEach = function (e, t) { for (var o in n) e(n[o]) && t(n[o]) } }, com.servinf.geo.CartoDbLayer = function (e, t, o, n) { function i() { cartodb.createLayer(r, { user_name: l, type: "cartodb", sublayers: s.sublayers || [], interactivity: s.interactivity.join(",") || [], interaction: s.interaction || !0 }, { https: !0, layerIndex: 1024 }).addTo(r).done(function (e) { c = e, a() }).error(function (e) { }) } function a() { var e = p["default"] = c.createSubLayer({ sql: s.sql, cartocss: s.css, interactivity: s.interactivity }); if (s.interaction && e.setInteraction(s.interaction), s.events) for (var t in s.events) e.on(t, s.events[t]); console.log(e) } var r = o, s = n, l = e, c = void 0, p = {}; this.on = function () { for (var e in p) p[e].show() }, this.off = function () { for (var e in p) p[e].hide() }, i() }, com.servinf.geo.GeoViewer = function (e) { function t() { C = new google.maps.Map(P.containerMap, P.map_config), L = new google.maps.Geocoder, E = new google.maps.InfoWindow, google.maps.event.addListener(E, "domready", function () { dispatchCustomEvent("ON_INFOWINDOW_DOMREADY", { detail: { info: this.info, infowindow: this } }) }), M = new google.maps.DistanceMatrixService, S = new google.maps.DirectionsService, N = new google.maps.DirectionsRenderer({ map: C }), b = new google.maps.TrafficLayer, A["default"] = new com.servinf.geo.Layer("default", C), P.drawing === !0 && (T = new google.maps.drawing.DrawingManager(P.drawingOptions), T.setMap(C), google.maps.event.addListener(T, "overlaycomplete", function (e) { dispatchCustomEvent("ON_COMPLETE_DRAW_OVERLAY", { detail: { key: P.keyGeo, event: e } }) })), P.user_marker === !0 && (O = new google.maps.Marker({ title: "Mi PosiciÃ³n", map: C, icon: P.userMarkerConfig.icon }), P.geolocation && o()), google.maps.event.addListener(C.getStreetView(), "visible_changed", function () { setTimeout(function () { var e = C.getStreetView().getVisible(); dispatchCustomEvent("ON_STREET_VIEW_VISIBLE_CHANGED", { detail: { visible: e } }) }, 1e3) }), google.maps.event.addListener(C, "zoom_changed", function () { setTimeout(function () { var e = C.getZoom(); dispatchCustomEvent("ON_ZOOM_CHANGED", { detail: { zoom: e } }) }, 1e3) }), dispatchCustomEvent("ON_COMPLETE_CREATE_MAP", { detail: { key: P.keyGeo } }) } function o(e) { if (navigator.geolocation) { var t = new Promise(function (t, o) { navigator.geolocation.getCurrentPosition(function (o) { console.info("Success Getting Coords"), dispatchCustomEvent("ON_SUCCESS_GETTING_COORDS", { detail: { pos: o, actions: e } }), t(o) }, function (t) { console.info("Error Getting Coords"), dispatchCustomEvent("ON_FAILED_GETTING_COORDS", { detail: { error: t, actions: e } }), o(t) }) }); t.then(function (e) { var t = new google.maps.LatLng(e.coords.latitude, e.coords.longitude); O.setPosition(t), C.setCenter(t), C.setZoom(17) })["catch"](function (e) { var t = C.getCenter(); O.setPosition(t), C.setZoom(17) }) } } function n() { return google.maps.event.trigger(C, "resize") } function i(e) { return C.fitBounds(e) } function a(e) { C.setOptions(e) } function r(e) { return new Promise(function (t, o) { L.geocode({ address: e }, function (e, n) { n === google.maps.GeocoderStatus.OK ? t(e) : o(n) }) }) } function s(e, t) { return new Promise(function (o, n) { L.geocode({ location: new google.maps.LatLng(parseFloat(t), parseFloat(e)) }, function (e, t) { t === google.maps.GeocoderStatus.OK ? o(e) : n(t) }) }) } function l(e, t, o) { return new Promise(function (n, i) { var a = t; void 0 === A[a] && (A[a] = new com.servinf.geo.Layer(a, C)); var r = void 0; r = o.position instanceof google.maps.LatLng ? o.position : new google.maps.LatLng(parseFloat(o.position.lat), parseFloat(o.position.lng)); var s = new google.maps.Marker({ id: e, layer: a, title: o.title || "Marker", info: o.info || {}, icon: o.icon, draggable: o.draggable || !1, animation: o.animation || null, map: 1 == o.visible ? C : null, position: r }); if (o.onCreated && o.onCreated(s), o.events) for (var l in o.events) s.addListener(l, function (e) { o.events[l](e, this.id, this.layer, this) }); if (o.pan_to) { console.log(o.pan_to), C.setCenter(r); var c = void 0 !== o.zoom ? o.zoom : 17; C.setZoom(c) } A[a].addOverlay(e, s), n(s) }) } function c(e, t, o) { return new Promise(function (n, i) { var a = t; void 0 === A[a] && (A[a] = new com.servinf.geo.Layer(a, C)); var r = []; if (o.strCoords) { var s = o.coordSeparator || ";", l = o.valSeparator || ",", c = o.strCoords.split(s); r = c.map(function (e) { var t = e.split(l); return { lat: parseFloat(t[1]), lng: parseFloat(t[0]) } }) } var p = new google.maps.Polygon({ id: e, layer: a, title: o.title || "Poligono", info: o.info || {}, paths: r, strokeColor: o.lineColor || "#FF0000", strokeOpacity: .8, strokeWeight: 2, fillColor: o.backgroundColor || "#FF0000", fillOpacity: o.opacity || .8, map: C }); p.setMap(C), o.onCreated && o.onCreated(p), o.events && Object.keys(o.events).forEach(function (e) { p.addListener(e, function (t) { o.events[e](t, this.id, this.layer, this) }) }), A[a].addOverlay(e, p), n(p) }) } function p(e, t, o) { return new Promise(function (n, i) { var a = t; void 0 === A[a] && (A[a] = new com.servinf.geo.Layer(a, C)); var r = new google.maps.visualization.HeatmapLayer({ data: o.coords, dissipating: !0, opacity: o.opacity || .5, radius: o.radius || 13 }); r.setMap(C), A[a].addOverlay(e, r), n(r) }) } function u(e, t, o) { return void 0 !== I[e] ? t === !0 ? I[e].on() : I[e].off() : void (I[e] = new com.servinf.geo.CartoDbLayer(o.user_name, e, C, o)) } function f(e, t) { if (0 === t.length) return C.setMapTypeId(google.maps.MapTypeId.ROADMAP); var o = new google.maps.StyledMapType(t, { name: e }); return C.mapTypes.set(e, o), C.setMapTypeId(e) } function d(e, t) { var o = new google.maps.StyledMapType(t, { name: e }); return C.mapTypes.set(e, o) } function g(e, t) { return t ? C.setMapTypeId(e) : C.setMapTypeId(google.maps.MapTypeId.ROADMAP) } function m(e, t, o) { if (1 == o) { var n = new google.maps.InfoWindow; return n.setContent(e), void (t instanceof google.maps.LatLng ? (n.setPosition(t), n.open(C)) : t instanceof google.maps.Marker && n.open(C, t)) } E.setContent(e), t instanceof google.maps.LatLng ? (E.setPosition(t), E.open(C)) : t instanceof google.maps.Marker && E.open(C, t) } function v(e, t, o, n, i) { var a = { origin: O.getPosition(), destination: new google.maps.LatLng(parseFloat(e), parseFloat(t)), travelMode: o || google.maps.TravelMode.DRIVING }; S.route(a, function (e, t) { t == google.maps.DirectionsStatus.OK ? (N.setMap(C), N.setDirections(e), n && N.setPanel(n[0])) : alertify.alert("No se encontro una ruta"), i && i(t) }) } function y(e) { setTimeout(function () { var t = C.getZoom() + e; C.setZoom(t) }, 2e3) } function h(e) { return (e + "").replace(",", ".") } var w = this, C = null, T = null, L = null, E = null, O = null, M = null, M = null, S = null, N = null, b = null, A = {}, I = {}, k = { map_config: {}, drawing: !1, drawingOptions: {}, keyGeo: "KEY_GEO_INSTANCE_" + (new Date).getTime() }, P = _.extend(k, e); this.routingCarMyPosition = function (e, t, o, n) { return v(e, t, google.maps.TravelMode.DRIVING, o, n) }, this.routingWalkMyPosition = function (e, t, o, n) { return v(e, t, google.maps.TravelMode.WALKING, o, n) }, this.deleteRoute = function () { N.setMap(null), N.setPanel(null) }, this.carRouting = function (e, t, o, n, i) { var a = void 0; a = e instanceof google.maps.LatLng ? { origin: e, destination: t, travelMode: google.maps.TravelMode.DRIVING } : { origin: new google.maps.LatLng(parseFloat(e), parseFloat(t)), destination: new google.maps.LatLng(parseFloat(e), parseFloat(t)), travelMode: google.maps.TravelMode.DRIVING }, S.route(a, function (e, t) { t == google.maps.DirectionsStatus.OK ? (N.setMap(C), N.setDirections(e), i && N.setPanel(i[0])) : alertify.alert("No se encontro ruta en Auto.") }) }, window.carRouting = this.carRouting, this.walkRouting = function (e, t, o, n, i) { var a = { origin: new google.maps.LatLng(parseFloat(e), parseFloat(t)), destination: new google.maps.LatLng(parseFloat(e), parseFloat(t)), travelMode: google.maps.TravelMode.WALKING }; S.route(a, function (e, t) { t == google.maps.DirectionsStatus.OK ? (N.setMap(C), N.setDirections(e), i && N.setPanel(i[0])) : alertify.alert("No se encontro ruta a pie") }) }, this.streetView = function (e, t) { return e instanceof google.maps.LatLng ? (C.getStreetView().setPosition(e), C.getStreetView().setVisible(!0)) : (C.getStreetView().setPosition(new google.maps.LatLng(parseFloat(h(e)), parseFloat(h(t)))), C.getStreetView().setVisible(!0)) }, this.setPanoramaPanel = function (e, t, o) { w.panorama = new google.maps.StreetViewPanorama(e, { position: t, pov: o || { heading: 34, pitch: 10 }, timeline: !0, motionTracking: !0, motionTrackingControl: !0 }), C.setStreetView(w.panorama) }, this.addStyle = function (e, t) { var o = new google.maps.StyledMapType(t, { name: e }); C.mapTypes.set(e, o), C.setMapTypeId(e) }, window.streetView = this.streetView, _.extend(this, { addMapStyle: d, addAndShowStyle: f, onOffMapStyle: g, addMarker: l, addPolygon: c, addHeatMap: p, fitBounds: i, geocodeDirect: r, geocodeInverse: s, onOffCartoDbLayer: u, showInfowindow: m, getCurrentPosition: o, increaseZoom: y, setMapOptions: a, setCenter: function (e) { C.setCenter(e) }, setZoom: function (e) { C.setZoom(parseInt(e)) }, getMap: function () { return C }, getLayers: function () { return A }, getCartoDbLayers: function () { return I }, markerUser: { get: function () { return O }, setPosition: function (e) { return O.setPosition(e) } }, traffic: { on: function () { return b.setMap(C) }, off: function () { return b.setMap(null) }, toggle: function () { return null == b.getMap() ? this.on() : this.off() } }, resizeMap: n }), t() }, Namespace("com.servinf.{0}.classes".format(window.spaceName)), com.servinf[window.spaceName].Config.LayerTypes = {}, com.servinf[window.spaceName].Config.LayerTypes.WEB_SERVICE = "webservice", com.servinf[window.spaceName].Config.LayerTypes.CARTODB = "cartodb", com.servinf[window.spaceName].Config.LayerTypes.LOCALVARIABLE = "localvariable", com.servinf[window.spaceName].Config.WS_Structure = {}, com.servinf[window.spaceName].Config.WS_Structure.NODE_STATUS = "responseStatus", com.servinf[window.spaceName].Config.WS_Structure.NODE_DATA = "responseData", com.servinf[window.spaceName].classes.Layer = function (e) { function t(e) { C.type == com.servinf[window.spaceName].Config.LayerTypes.WEB_SERVICE ? 1 == C.autoload && o(e) : C.type == com.servinf[window.spaceName].Config.LayerTypes.LOCALVARIABLE && 1 == C.autoload && n(e) } function o(e) { var t = C.methods || {}; $.ajax(C.url, { type: T.method || "GET", dataType: "json" }).done(function (o) { t.onFetchData && t.onFetchData(o); var n = (o[com.servinf[window.spaceName].Config.WS_Structure.NODE_STATUS], o[com.servinf[window.spaceName].Config.WS_Structure.NODE_DATA]); void 0 !== n ? (v = n, m = [], m = v instanceof Array ? v : v[T.node_list], r(), e && e()) : (console.error("La especificacion del servicio es erronea"), t.onError && t.onError(400, "La especificacion del servicio es erronea")) }).error(function () { t.onError && t.onError(500, "Ajax Error") }) } function n(e) { C.methods, void 0 !== C.List && C.List instanceof Array ? (m = C.List, r(), e && e()) : console.error("La especificacion del servicio es erronea") } function i(e, t) { var o = []; if (o = void 0 === e ? m : m.filter(function (t) { for (var o = !1, n = 0; n < e.length;) { var i = e[n]; if ("contains" === i.operator) { var a = com.servinf.clearSpecialChars(t[i.key].toUpperCase()), r = com.servinf.clearSpecialChars(i.value.toUpperCase()); o = a.indexOf(r) > -1 } if ("equals" === i.operator) { var s = i.value.split(","); o = 1 == s.length ? t[i.key] == i.value : s.indexOf(t[i.key]) != -1 } if ("lt" === i.operator && (o = parseFloat(t[i.key]) <= parseFloat(i.value)), "gt" === i.operator && (o = parseFloat(t[i.key]) >= parseFloat(i.value)), 0 == o) break; n++ } return o }), o.length > 0) { p(); var n = o.map(function (e) { return e.overlay }); if (C.cluster) return markerCluster.addMarkers(n), void markerCluster.fitMapToMarkers(); if (C.heat_map) return; n.forEach(function (e) { e.setMap(L.getMap()) }), a(n) } t && t(o) } function a(e) { var t = new google.maps.LatLngBounds; e.forEach(function (e) { t.extend(e.getPosition()) }); L.fitBounds(t) } function r() { var e = void 0; 1 == C.fitBounds && (e = new google.maps.LatLngBounds); var t = void 0, o = void 0; if (C.cluster) t = []; else if (C.heat_map) o = []; else if (C.thematic_dpto) return void l(); m.forEach(function (n, i) { var a = void 0; for (var r in n.geometry) { var s = r.toUpperCase(); n.geometry[s] = n.geometry[r] } if (n.geometry.LATITUD ? a = "marker" : n.geometry.POLIGONO && (a = "polygon"), "marker" == a) { var l = {}; C.thematic.forEach(function (e) { if (d(e.rule.key, e.rule.value, e.rule.operator, n)) return l = e, !0 }); var p = new google.maps.LatLng(parseFloat(c(n.geometry.LATITUD)), parseFloat(c(n.geometry.LONGITUD))), u = "MK_" + (new Date).getTime() + 100 * Math.random(1, 2); n.MarkerFlagId = u, L.addMarker(u, C.id, { visible: !(C.cluster || C.heat_map || C.thematic_dpto), info: n, title: n[C.keyTitle], icon: l.icon, position: p, onCreated: function (e) { n.overlay = e, C.cluster && t.push(e), C.heat_map && o.push(e.getPosition()) }, events: { click: function (e, t, o, n) { var i = C.template_settings; if (i) if (i.templateString) { var a = Handlebars.compile(i.templateString), r = a(n.info); L.showInfowindow(r, n) } else if (i.element) { var s = i.element, l = $("#" + s).html(), a = Handlebars.compile(l), r = a(n.info); L.showInfowindow(r, n) } com.servinf.dispatchCustomEvent("ONCLICK_MARKER_INLAYER", { detail: { id: t, layer: o, info: n.info, overlay: n } }) } } }), void 0 !== e && e.extend(p) } }), void 0 !== e && L.fitBounds(e), C.cluster ? markerCluster = new MarkerClusterer(L.getMap(), t, { imagePath: "https://raw.githubusercontent.com/googlemaps/v3-utility-library/master/markerclustererplus/images/m", averageCenter: !0, onClickCluster: function (e, t, o, n) { if (e >= 18) { var i = C.cluster_options.primary_key, a = C.cluster_options.secondary_key; return s(o.center_, t, i, a), !1 } return !0 } }) : C.heat_map && L.addHeatMap((new Date).getTime(), C.id, { coords: o }).then(function (e) { w = e }) } function s(e, t, o, n) { var i = t.map(function (e) { return { id: e.info.MarkerFlagId, layer: C.id, name: e.info[o], name_s: e.info[n], info: e.info } }), a = '<ul id="cluster_list">     {{#each points}}       <li>         <div class="ctext">             <h1 class="primaryText">{{name}}</h1>             <span class="secondaryText">{{name_s}}</span>         </div>          <div class="cactions">             <button onclick="onClickItemListClusterer(\'{{id}}\', \'{{layer}}\')">                 <i class="material-icons">info</i>             </button>         </div>                 </li>     {{/each}} </ul> '; a = Handlebars.compile(a); var r = a({ points: i }); L.showInfowindow(r, e) } function l() { function e() { var e = C.thematic_dpto_options.dane_dpto; e || (e = C.thematic_dpto_options.date_dpto); var t = _.groupBy(m, e), o = C.thematic_dpto_options.thematic, n = C.thematic_dpto_options.opacity || .8, i = C.thematic_dpto_options.column_thematic || { type: "count" }, a = C.thematic_dpto_options.hover || "#FF0000", r = C.thematic_dpto_options.line || "#751400"; y.departamentos.forEach(function (e, s) { var l = t[e.CodDane]; if (l) { if (l = { department: e, items: l }, "count" == i.type) i.column = "count", l.count = l.items.length; else if ("numeric" == i.type) { var c = 0; for (var p in l.items) c += parseFloat(l.items[p][i.column]); l[i.column] = c } thematic = {}; for (var p in o) { var u = o[p]; if (d(i.column, u.rule.value, u.rule.operator, l)) { thematic = u; break } } var f = thematic.color || "#75145"; L.addPolygon(e.CodDane, "departments_layer_" + C.id, { info: e, title: e.Nombre.toUpperCase(), coordSeparator: ";", valSeparator: ",", info: l, opacity: n, backgroundColor: f, lineColor: r, strCoords: e.geometry, events: { click: function (e, t, o, n) { L.fitBounds(n.getBounds()), L.increaseZoom(1), com.servinf.dispatchCustomEvent("ONCLICK_DEPARTMENT_" + C.id, { detail: { info: n.info } }) }, mouseout: function (e, t, o, n) { n.setOptions({ fillColor: f }) }, mouseover: function (e, t, o, n) { n.setOptions({ fillColor: a }) } } }) } }) } $.getJSON(com.servinf[window.spaceName].Config.assets.departments).done(function (t) { y = t, e() }) } function c(e) { return (e + "").replace(",", ".") } function p() { C.cluster && "undefined" != typeof markerCluster && markerCluster.clearMarkers(), f() } function u() { return i() } function f() { m.forEach(function (e) { e.overlay && e.overlay.setMap(null) }) } function d(e, t, o, n) { if ("equals" === o) { if (n[e] == t) return !0 } else if ("lt" === o) { if (n[e] <= t) return !0 } else if ("gt" === o) { if (n[e] >= t) return !0 } else if ("range" === o) { var i = t.split(":"); if (n[e] >= parseFloat(i[0]) && n[e] <= parseFloat(i[1])) return !0 } else if ("*" === o) return !0; return !1 } function g() { return L.getLayers()[C.id] } var m = [], v = {}, y = [], h = { autoload: !1, specifications: {} }, w = void 0, C = $.extend(h, e), T = C.specifications, L = C.viewer, E = !0; $(document).on("ON_ZOOM_CHANGED", function (e) { if (E) { var t = e.detail.zoom; if (C.heat_map) { var o = L.getLayers()[C.id]; if (C.heat_map_options) { var n = C.heat_map_options.max_zoom || 30; t >= n ? (o && o.show(), w && w.setMap(null)) : (o && o.hide(), w && null === w.getMap() && w.setMap(L.getMap())) } } } }), $(document).on("ONCLICK_ITEMlIST_CLUSTERER", function (e) { var t = e.detail, o = t.id; if (t.layer === C.id) { var n = g(); if (n) { var i = n.getOverlay(o); google.maps.event.trigger(i, "click") } } }), $.extend(this, { filter: i, hide: p, show: u, getGeoLayer: g }), t() }, Namespace("com.servinf.{0}".format(window.spaceName)), com.servinf[window.spaceName].ComponentMaps = function (e, t) {
    function o() { $(u).append(_), com.servinf.getScripts(com.servinf[window.spaceName].Config.jsRequired(), function () { addGoogleUtils(), n(function () { }) }) } function n(e) { instanceGeo = p.instanceGeo = new com.servinf.geo.GeoViewer({ containerMap: $("#map_container_container")[0], map_config: { center: { lat: 5.203044073033952, lng: -75.28946261230469 }, zoom: 5, mapTypeControl: !0, mapTypeId: w.map_type || google.maps.MapTypeId.ROADMAP, mapTypeControlOptions: { position: google.maps.ControlPosition.LEFT_TOP } }, user_marker: !0, geolocation: w.request_position, userMarkerConfig: { icon: "assets/img/user_marker.png" }, drawing: w.drawing || !1, drawingOptions: { drawingControl: !0, drawingControlOptions: { position: google.maps.ControlPosition.RIGHT_TOP, drawingModes: [google.maps.drawing.OverlayType.MARKER, google.maps.drawing.OverlayType.CIRCLE, google.maps.drawing.OverlayType.RECTANGLE, google.maps.drawing.OverlayType.POLYGON, google.maps.drawing.OverlayType.POLYLINE] }, markerOptions: { draggable: !0 }, circleOptions: {}, polygonOptions: { editable: !0, zIndex: 1 }, polylineOptions: { editable: !0, zIndex: 1 } } }); var t = $("#streetview_panel"); if (w.streetview_panel) { var o = $("#container_compontent_map").width(), n = o / 100 * w.streetview_panel; $("#map_container_container").width(o - n), t.width(n), instanceGeo.setPanoramaPanel(t[0]) } else t.hide(); if (w.map_options && $("#icons_options").show(), w.search_bar && ($("#container_compontent_map").append(C), d = new google.maps.places.Autocomplete(document.getElementById("dialog_map_text"), { componentRestrictions: { country: "co" } }), google.maps.event.addListener(d, "place_changed", function (e) { var t = this.getPlace(); instanceGeo.setCenter(t.geometry.location), instanceGeo.fitBounds(t.geometry.viewport) })), w.initial_position && w.initial_position.lat && w.initial_position.lng) { var a = new google.maps.LatLng(parseFloat(w.initial_position.lat), parseFloat(w.initial_position.lng)); instanceGeo.setCenter(a), isNaN(w.initial_position.zoom) || instanceGeo.setZoom(w.initial_position.zoom) } f = !0, e && e(p), w.module == com.servinf[spaceName].Config.modules.VIEWER_DATA ? (i(), l()) : w.module == com.servinf[spaceName].Config.modules.DEPARTMENTS_VIEW ? (instanceGeo.addStyle("WHITE_MAP", [{ featureType: "water", elementType: "geometry", stylers: [{ color: "#e9e9e9" }, { lightness: 17 }] }, { featureType: "landscape", elementType: "geometry", stylers: [{ color: "#f5f5f5" }, { lightness: 20 }] }, { featureType: "road.highway", elementType: "geometry.fill", stylers: [{ color: "#ffffff" }, { lightness: 17 }] }, { featureType: "road.highway", elementType: "geometry.stroke", stylers: [{ color: "#ffffff" }, { lightness: 29 }, { weight: .2 }] }, { featureType: "road.arterial", elementType: "geometry", stylers: [{ color: "#ffffff" }, { lightness: 18 }] }, { featureType: "road.local", elementType: "geometry", stylers: [{ color: "#ffffff" }, { lightness: 16 }] }, { featureType: "poi", elementType: "geometry", stylers: [{ color: "#f5f5f5" }, { lightness: 21 }] }, { featureType: "poi.park", elementType: "geometry", stylers: [{ color: "#dedede" }, { lightness: 21 }] }, { elementType: "labels.text.stroke", stylers: [{ visibility: "on" }, { color: "#ffffff" }, { lightness: 16 }] }, { elementType: "labels.text.fill", stylers: [{ saturation: 36 }, { color: "#333333" }, { lightness: 40 }] }, { elementType: "labels.icon", stylers: [{ visibility: "off" }] }, { featureType: "transit", elementType: "geometry", stylers: [{ color: "#f2f2f2" }, { lightness: 19 }] }, { featureType: "administrative", elementType: "geometry.fill", stylers: [{ color: "#fefefe" }, { lightness: 20 }] }, { featureType: "administrative", elementType: "geometry.stroke", stylers: [{ color: "#fefefe" }, { lightness: 17 }, { weight: 1.2 }] }]), componentMaps.instanceGeo.getMap().setOptions({ mapTypeControl: !1 }), r(s)) : w.module == com.servinf[spaceName].Config.modules.DEPARTMENT_VIEW ? console.log("department view") : w.module == com.servinf[spaceName].Config.modules.FORM_CAPTURE && (console.info("FORM_CAPTURE"), v = new com.servinf[window.spaceName].classes.FormaCapture(w.details, instanceGeo)) } function i() { void 0 !== w.details.layers && w.details.layers.forEach(function (e) { e.viewer = instanceGeo; var t = e.id || "LAYER_" + (new Date).getTime(); h[t] = new com.servinf[window.spaceName].classes.Layer(e) }) } function a(e) { e.autoload = !0, e.viewer = instanceGeo; var t = e.id || "LAYER_" + (new Date).getTime(); h[t] = new com.servinf[window.spaceName].classes.Layer(e) } function r(e) { $.getJSON(com.servinf[window.spaceName].Config.assets.departments).done(function (t) { m = t, e && e() }) } function s() { m.departamentos.forEach(function (e) { var t = w.details.background || "#7514FF", o = w.details.hover || "#FF0000"; instanceGeo.addPolygon(e.CodDane, "departments", { info: e, title: e.Nombre.toUpperCase(), coordSeparator: ";", valSeparator: ",", backgroundColor: t, lineColor: w.details.line || "#751400", strCoords: e.geometry, events: { click: function (e, t, o, n) { w.details.fitBounds && (instanceGeo.fitBounds(n.getBounds()), instanceGeo.increaseZoom(1)), com.servinf.dispatchCustomEvent("ONCLICK_DEPARTMENT", { detail: { info: n.info } }) }, mouseout: function (e, o, n, i) { i.setOptions({ fillColor: t }) }, mouseover: function (e, t, n, i) { i.setOptions({ fillColor: o }) } } }) }) } function l() { if (w.details.initialPoint) { g = w.details.initialPoint; var e = new google.maps.LatLng(parseFloat(g.Latitud), parseFloat(g.Longitud)); instanceGeo.addMarker("initial_marker", "default", { visible: !0, icon: g.icon, position: e, title: g.name, info: g, pan_to: w.request_position === !1, events: { click: function (e, t, o, n) { g.templateString && instanceGeo.showInfowindow(g.templateString, n, !1) } } }).then(function (e) { g.marker = e, g.streetview && instanceGeo.streetView(e.getPosition()) }) } } function c(e, t) { var o = void 0; if ("polygon" == e) var o = "st_geomfromtext('POLYGON(({0}))', 4326)".format(t); void 0 !== v && void 0 !== o && v.saveGeometry(o, function (e) { console.log(e) }) } var p = this, u = e, f = !1, d = void 0, g = void 0, m = [], v = void 0, y = { request_position: !1 }, h = {}, w = $.extend(y, t), _ = '<div id="container_compontent_map">    <ul id="icons_options">        <li>            <a href="#" title="Administrar Capas">                <i class="material-icons">layers</i>            </a>        </li>        <li>            <a href="#" title="Ver Detalles de Rutas">                <i class="material-icons">directions_car</i>            </a>        </li>        <li>            <a href="#" title="Ver Capa de TrÃ¡fico">                <i class="material-icons">traffic</i>            </a>        </li>    </ul>    <div id="layers_list" class="panel"></div>    <div id="map_container_container"></div>    <div id="streetview_panel"></div></div>', C = '<form id="form_dialog_map" onsubmit="return false;">    <input type="text" id="dialog_map_text"/>     <button type="button" id="dialog_map_button">         Buscar     </button> </form> ';
    $(document).on("ON_SUCCESS_GETTING_COORDS", function (e) { if (g) { var t = new google.maps.LatLng(e.detail.pos.coords.latitude, e.detail.pos.coords.longitude); g.routing ? instanceGeo.carRouting(t, g.marker.getPosition()) : setTimeout(function () { var e = new google.maps.LatLngBounds; e.extend(t), e.extend(g.marker.getPosition()), instanceGeo.fitBounds(e) }, 1500) } }), $(document).on("ON_FAILED_GETTING_COORDS", function (e) { }), $(document).on("ON_COMPLETE_DRAW_OVERLAY", function (e) { var t = e.detail.event.type, o = e.detail.event.overlay; o.addListener("rightclick", function () { return this.setMap(null) }), t === google.maps.drawing.OverlayType.CIRCLE || t === google.maps.drawing.OverlayType.RECTANGLE ? (instanceGeo.fitBounds(o.getBounds()), o.setMap(null)) : t === google.maps.drawing.OverlayType.POLYGON && o.addListener("click", function (e) { var t = this.getPath(), o = []; t.forEach(function (e) { o.push("{0} {1}".format(e.lng(), e.lat())) }), o.push("{0} {1}".format(t.getAt(0).lng(), t.getAt(0).lat())); var n = '<button onclick=\'addGeometry("polygon", "{0}")\'>Agregar Geometria</button>'.format(o.join(",")); instanceGeo.showInfowindow(n, e.latLng), console.log(n) }) }), window.addGeometry = c, window.onClickItemListClusterer = function (e, t) { com.servinf.dispatchCustomEvent("ONCLICK_ITEMlIST_CLUSTERER", { detail: { id: e, layer: t } }) }, $.extend(this, { getLayers: function () { return h }, getViewer: function () { return instanceGeo }, addLayer: a }), o()
};