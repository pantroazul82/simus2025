@model WebSImus.Models.EventoModels
@using MvcCheckBoxList.Model
@{
    ViewBag.Title = "Concierto";
    Layout = "~/Views/Shared/_LayoutCelebra.cshtml";
}

@using (Html.BeginForm("Evento", "Musica", FormMethod.Post, new { enctype = "multipart/form-data", @class = "form-horizontal" }))

{
    <br />
    <br />
    @Html.ValidationSummary(true)

    @Html.HiddenFor(model => model.Nombre, new { @class = "form-control text", @maxlength = "255", @readonly = true })
     @Html.HiddenFor(model => model.FechaEvento, new { @class = "form-control text", @readonly = true })
    <div class="container">
        <div class="row">
            <h2>Celebra la música 24 de noviembre de 2019</h2>
            <div class="panel-body" id="panelEditar">
                <hr class="colorgraph">
                <div class="row">
                    <div class="form-group">

                        @Html.HiddenFor(model => model.Tipo)

                        <h3>Ubicación</h3>
                        <div class="col-md-4">
                            <label class="col-md-12">Departamento * </label>
                            <div class="col-md-12">
                                @Html.DropDownListFor(model => model.CodigoDepartamento, (SelectList)ViewBag.listDepartamentos, "Seleccione un departamento", new { @class = "styled-select" })
                                @Html.ValidationMessageFor(model => model.CodigoDepartamento, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="col-md-12">Municipio *</label>
                            <div class="col-md-12">
                                @Html.DropDownListFor(model => model.CodigoMunicipio, (SelectList)ViewBag.listMunicipio, "Seleccione un municipio", new { @class = "styled-select" })
                                @Html.ValidationMessageFor(model => model.CodigoMunicipio, "", new { @class = "text-danger" })
                            </div>
                            <div id="panelAgregar" class="panel-body">
                                @Html.Action("_SolicitudActualizacion")
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="col-md-12">Lugar del concierto *</label>
                            <div class="col-md-12">
                                @Html.TextBoxFor(model => model.LugarEvento, new { @class = "form-control text", @maxlength = "500" })
                                @Html.ValidationMessageFor(model => model.LugarEvento, "", new { @class = "text-danger" })
                            </div>
                        </div>
                    </div>
                </div>
                <hr style="height: 1px; background: #CCC">
                <div class="row">
                    <div class="form-group">
                        <h3>Organiza</h3>
                        <div class="col-md-4">
                            <label class="col-md-12">Entidad organizadora *</label>
                            <div class="col-md-12">
                                @Html.TextBoxFor(model => model.EntidadOrganizadora, new { @class = "form-control text", @maxlength = "500" })
                                @Html.ValidationMessageFor(model => model.EntidadOrganizadora, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="col-md-12">Teléfono de la entidad *</label>
                            <div class="col-md-12">
                                @Html.TextBoxFor(model => model.Telefono, new { @class = "form-control text" })
                                @Html.ValidationMessageFor(model => model.Telefono, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="col-md-12">Correo electrónico de la entidad</label>
                            <div class="col-md-12">
                                @Html.TextBoxFor(model => model.Email, new { @class = "form-control text" })
                                @Html.ValidationMessageFor(model => model.Email, "", new { @class = "text-danger" })
                            </div>
                        </div>
                    </div>
                </div>
                <hr style="height: 1px; background: #CCC">
                <div class="row">
                    <div class="form-group">
                        <h3>Concierto</h3>
                    
                        <div class="col-md-4">
                            <label class="col-md-12">Hora del concierto *</label>
                            <div class="col-md-12">
                                @Html.TextBoxFor(model => model.HoraEvento, new { @class = "form-control icon-time" })
                                @Html.ValidationMessageFor(model => model.HoraEvento, "", new { @class = "text-danger" })
                            </div>
                        </div>
                       
                    </div>
                </div>
               
                <hr style="height: 1px; background: #CCC">
                <div class="row">
                    <div class="form-group">
                        <h3>Acerca del concierto</h3>
                      
                        <div class="col-md-4">
                            <label class="col-md-12">Subir foto *</label>
                            <div class="col-md-12">
                                <h6>Tipos de archivo permitidos: .jpg y .png de tamaño máximo 2.5 Mb</h6>
                                <h6>Recomendamos subir fotografía referente a la actividad musical en el municipio</h6>
                                <input onclick="resizePanel()" id="imagenPerfil" name="imagenPerfil" type="file">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="col-md-12">Descripción</label>
                            <div class="col-md-12">
                                @Html.TextAreaFor(model => model.Descripcion, new { @class = "form-control text", @rows = "10", @cols = "50" })
                                @Html.ValidationMessageFor(model => model.Descripcion, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="" id="user_image">
                                <img src="@Url.Content(ViewBag.ImageData)" class="img-responsive" />
                            </div>
                        </div>
                    </div>
                </div>

                <hr style="height: 1px; background: #CCC">
                <div class="row">
                    <div class="form-group">
                        <div class="col-md-3">
                            <div class="col-md-12">
                                <input type="submit" value="Guardar" name="Guardar" class="btn btn-primary pull-right" id="btnGuardar" />
                                <div class="btn btn-default pull-left">
                                    <i class="fa fa-arrow-circle-o-left"></i>@Html.ActionLink("Regresar", "Index", "Musica")
                                </div>
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
@section Scripts {

    @Scripts.Render("~/Scripts/jqueryval")
    <script src="@Url.Content("~/Scripts/plugins/icheck/icheck.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/fileinput/fileinput.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/fileinput/fileinput_locale_es.js")"></script>

    <script type="text/javascript">
        $('#HoraEvento').timepicker({
            template: false,
            showInputs: false,
            minuteStep: 5
        });

        var pagecontentwrapHeight = $(".page-content-wrap").height();
        $('#panelEditar').css("height", pagecontentwrapHeight);

        $('#imagenPerfil').fileinput({
            showUpload: false,
            language: 'es',
            overwriteInitial: true,
            maxFileSize: 2560,
            allowedFileExtensions: ['jpg', 'png'],
        });


        $(window).on('resize', function () {
            var new_pagecontentwrapHeight = pagecontentwrapHeight + 200;
            $('#panelEditar').css("height", new_panelbodyHeight);
            $('#panelEditar').css("min-height", pagecontentwrapHeight + 350);
        });

        function resizePanel() {
            var new_pagecontentwrapHeight = pagecontentwrapHeight + 200;
            $('#panelEditar').css("height", new_pagecontentwrapHeight);
        };

        $(function () {
            $('#CodigoDepartamento').change(function () {
                var selectedDep = $(this).val();
                var city = $('#CodigoMunicipio');

                if (selectedDep != null && selectedDep != '') {

                    $.getJSON('@Url.Action("ObtenerMunicipio", "Entidad")', { departamento: selectedDep }, function (data) {
                        var items = '';
                        items = '<option>Seleccione un municipio </option>';
                        $.each(data, function (i, municipio) {
                            items += "<option value='" + municipio.value + "'>" + municipio.text + "</option>";

                        });
                        city.empty();
                        city.html(items);
                        city.click();

                    });

                }

            })

            // por país
            $('#CodigoPais').change(function () {
                var selectedDep = $(this).val();
                var city = $('#CodigoDepartamento');
                var varmunicipio = $('#CodigoMunicipio');

                if (selectedDep != null && selectedDep != '') {

                    $.getJSON('@Url.Action("ObtenerDepartamento")', { codigopais: selectedDep }, function (data) {
                        var items = '';
                        items = '<option>Seleccione un departamento </option>';
                        $.each(data, function (i, departamento) {
                            items += "<option value='" + departamento.value + "'>" + departamento.text + "</option>";

                        });
                        city.empty();
                        city.html(items);
                        city.click();
                        varmunicipio.empty();

                    });

                }

            })

            $('#CodigoMunicipio').change(function () {
                var selectedMun = $(this).val();

                if (selectedMun != null && selectedMun != '') {
                    CargarEventos(selectedMun);
                }

            })
        });

        function CargarEventos(varMunicipio) {

            $.ajax({

                url: "/Musica/_SolicitudActualizacion",
                type: "GET",
                data: { CodMunicipio: varMunicipio }
            })
           .done(function (partialViewResult) {
               $("#panelAgregar").html(partialViewResult);

               $('#modalValidacionConciertos').modal({ show: true });


           });

        }
        function SolicitarPermisos(varEventoId) {
            var varCodMunicipio = $('#CodigoMunicipio').val();
            alert(varCodMunicipio);
            var url = '@Url.Action("AgregarUsuario", "Musica")';
            $.ajax({
                url: url,
                type: 'POST',
                data: {
                    EventoId: varEventoId, CodMunicipio: varCodMunicipio
                },
                success: function (data) {
                    if (data) {
                        $(':input', '#myForm')
                          .not(':button, :submit, :reset, :hidden')
                          .val('')
                          .removeAttr('checked')
                          .removeAttr('selected');
                        $("#modalValidacionConciertos").modal('hide');
                        $('body').removeClass('modal-open');
                        $('.modal-backdrop').remove();
                        alert("Se realizo la solicitud con éxito.")
                        window.location.href = '/Musica/Index';
                    }
                },

            });

        }
    </script>
}





