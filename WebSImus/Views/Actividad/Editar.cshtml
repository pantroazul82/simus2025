@model SM.LibreriaComun.DTO.EntidadesOperadoras.ActividadDTO
@{
    ViewBag.Title = "Nuevo actividad";
    Layout = "~/Views/Shared/_LayoutEstandar.cshtml";
}

@using (Html.BeginForm("Editar", "Actividad", FormMethod.Post, new { enctype = "multipart/form-data", @class = "form-horizontal" }))
{

    <ul class="breadcrumb">
        <li>@Html.ActionLink("Inicio", "Index", "Inicio")</li>
        <li>@Html.ActionLink("Actividad", "Index", "Actividad")</li>
        <li>@Html.ActionLink("Ver convenio", "Editar", "Convenio", new { Id = Model.ConvenioId }, null)</li>
    </ul>

    <div class="row">
        <div class="form-group">
            <div class="col-md-12">
                @Html.ActionLink("Agregar cronograma", "Crear", "Cronograma", new { Id = Model.Id }, new { @class = "btn btn-warning glyphicon glyphicon-plus-sign" })
                @Html.ActionLink("Ver cronogramas", "Index", "Cronograma", new { Id = Model.Id }, new { @class = "btn btn-success glyphicon glyphicon-plus-sign" })
            </div>
        </div>
    </div>
    <div class="panel panel-primary form-horizontal">
        @Html.ValidationSummary(true)
        @Html.HiddenFor(model => model.ConvenioId)

        <div class="panel-body" id="panelEditar">
            @Html.Partial("_Datos", Model)
            <div class="panel-footer">
                <input type="submit" value="Guardar" name="Guardar" class="btn btn-primary pull-right" id="btnGuardar" />

            </div>
        </div>
    </div>

    <div class="panel panel-default" id="panelmastercontenido">
        <div class="row push-down-20">
            <h3><span class="fa-representante fa-2x"></span> Contenido</h3>
        </div>
        <div class="form-group">
            <div class="col-md-12 col-xs-12">

                <a href="#" id="btnAgregarContenido" class="btn btn-success glyphicon glyphicon-plus-sign" data-toggle="modal" data-target="#modal_datosContenido" onclick="javascript: CargarModalContenido('0');" title="Agregar/editar contenido"> Agregar/Editar </a>
            </div>
        </div>
        <div class="row push-up-20">
            <div class="col-md-12">
                <div id="DivTablaContenido" class="panel-body">
                    @Html.Action("TablaContenido", new { ActividadId = Model.Id, EliminarId = 0 })
                </div>
                <div id="panelAgregarContenido" class="panel-body">
                    @Html.Action("_AgregarContenido", new { Id = 0, ActividadId = Model.Id })
                </div>
            </div>
        </div>
    </div>
}

@section Scripts {

    @Scripts.Render("~/Scripts/jqueryval")
    <script src="@Url.Content("~/Scripts/plugins/icheck/icheck.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/fileinput/fileinput.js")"></script>
    <script src="@Url.Content("~/Scripts/plugins/fileinput/fileinput_locale_es.js")"></script>

    <script type="text/javascript">

        $(function () {
            $('#TipoActividadId').change(function () {
                var selectedDep = $(this).val();     
                if (selectedDep == "209")
                    $("#panelmastercontenido").hide();
                else 
                    $("#panelmastercontenido").show();

            })
        });

        $(document).ready(function () {
            var valor = $("#TipoActividadId").val();
            if (valor == "209")
                $("#panelmastercontenido").hide();
            else
                $("#panelmastercontenido").show();
        });

        function ValidaSoloNumeros() {
            console.log("ValidaSoloNumeros");
            if ((event.keyCode < 48) || (event.keyCode > 57))
                event.returnValue = false;
        }

        $('#ValorEjecutado').keypress(function () {
            ValidaSoloNumeros();
        });

        $('#ValorProgramado').keypress(function () {
            ValidaSoloNumeros();
        });

        $('#NumeroDias').keypress(function () {
            ValidaSoloNumeros();
        });


        //Contenido
        function ContenidoAgregar(varID) {

            var varActividadId = '@Model.Id';
            var registro1 = {
                Id: varID,
                ActividadId: varActividadId,
                DescripcionContenido: $("#DescripcionContenido").val(),
                NombreContenido: $("#NombreContenido").val()

            };

            var url = '@Url.Action("AgregarContenido", "Actividad")';

            $.ajax({
                url: url,
                type: 'POST',
                data: {
                    Id: varID, ActividadId: varActividadId, model: registro1
                },
                success: function (data) {
                    if (data) {
                        $(':input', '#myForm')
                          .not(':button, :submit, :reset, :hidden')
                          .val('')
                          .removeAttr('checked')
                          .removeAttr('selected');
                        ActualizarlistadoContenido(0);
                    }
                },

            });
        }
        function ActualizarlistadoContenido(varEliminar) {
            var varActividadId = '@Model.Id';

            $("#DescripcionContenido").val("");
            $("#NombreContenido").val("");

            $.ajax({

                url: "/Actividad/TablaContenido",
                type: "GET",
                data: { ActividadId: varActividadId, EliminarId: varEliminar }
            })
           .done(function (partialViewResult) {

               $("#DivTablaContenido").html(partialViewResult);

           });
        }

        function CargarModalContenido(varId) {
            var varActividadId = '@Model.Id';
            var url = '@Url.Action("_AgregarContenido", "Actividad")';

            $.ajax({
                url: url,
                type: 'GET',
                data: { id: varId, ActividadId: varActividadId },
                success: function (response) {

                },
                error: function (result) {
                    alert('ERROR ' + result.status + ' ' + result.statusText);
                }
            })
            .done(function (partialViewResult) {
                $("#panelAgregarContenido").html(partialViewResult);
                $('#modal_datosContenido').modal('show');
                $('body').removeClass('modal-open');
                $('.modal-backdrop').remove();

            });

        }

        function EliminarContenido() {
            var varId = $('#item-to-deletem').val();
            ActualizarlistadoContenido(varId);
        }
    </script>
}



