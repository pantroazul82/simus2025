@model SM.LibreriaComun.DTO.EstudiantesEstadisticasDTO
@{
    ViewBag.Title = "Estadísticas - Estudiantes";
    Layout = "~/Views/Shared/_LayoutPublico.cshtml";
}

<div class="container-fluid py-4">
    <div class="row align-items-center mb-4">
        <div class="col-md-8 col-sm-12">
            <h1 class="titulo-indicador"><i class="fa-solid fa-chart-simple me-2"></i>Estadísticas · <span id="txtStatus1">@Html.Label("Actual")</span></h1>
        </div>
        <div class="col-md-4 col-sm-12 text-end">
            @Html.DropDownListFor(model => model.selectorAno, (SelectList)ViewBag.listAnos, "Año", new { @class = "form-select selector-ano", @id = "selectorAno" })
        </div>
    </div>

    <!-- Secciones resumen -->
    <div class="row g-4 mb-5">
        <div class="col-md-3 col-sm-6">
            <a href="#" class="stat-card" onclick="RedireccionaEscuelas();return false;">
                <i class="fa-solid fa-school"></i>
                <h5>Escuelas</h5>
            </a>
        </div>
        <div class="col-md-3 col-sm-6">
            <a href="#" class="stat-card" onclick="RedireccionaEstudiantes();return false;">
                <i class="fa-solid fa-user-graduate"></i>
                <h5>Estudiantes</h5>
            </a>
        </div>
        <div class="col-md-3 col-sm-6">
            <a href="#" class="stat-card" onclick="RedireccionaDocentes();return false;">
                <i class="fa-solid fa-chalkboard-user"></i>
                <h5>Docentes</h5>
            </a>
        </div>
        <div class="col-md-3 col-sm-6">
            <a href="#" class="stat-card" onclick="RedireccionaMapa();return false;">
                <i class="fa-solid fa-map-location-dot"></i>
                <h5>Mapa</h5>
            </a>
        </div>
    </div>

    <!-- Contenedor para las gráficas -->
    <div class="row">
        <div class="col-xl-10 offset-xl-1 col-12">
            @Html.Partial("_DatosEstudiantes", Model)
        </div>
    </div>
</div>


@section Scripts {
    <script src="@Url.Content("~/Scripts/Canvas/canvasjs.js")"></script>

    <script type="text/javascript">
        window.onload = function () {
            var periodo = '@Model.selectorAno';
            if (periodo == "1")
            { $('#txtStatus1').text('Actual'); }
            else {
                $('#txtStatus1').text(periodo);
            }
            CargarUbicacionGeografica(periodo);
            CargarRangosEtariosBarras(periodo);
            CargarGrupoEtnico(periodo);
            CargarSexo(periodo);
        }

        function RedireccionaMapa() {
            var VarTipo = $('#selectorAno').val();
            var url = "/Indicadores/Mapa?Id=" + VarTipo;
            window.location.href = url;
        }
        function RedireccionaEstudiantes() {
            var VarTipo = $('#selectorAno').val();
            var url = "/Indicadores/Estudiantes?Id=" + VarTipo;
            window.location.href = url;
        }

        function RedireccionaDocentes() {
            var VarTipo = $('#selectorAno').val();
            var url = "/Indicadores/Docentes?Id=" + VarTipo;
            window.location.href = url;
        }

        function RedireccionaEscuelas() {
            var VarTipo = $('#selectorAno').val();
            var url = "/Indicadores/Escuelas?Id=" + VarTipo;
            window.location.href = url;
        }

        $('#selectorAno').change(function () {
            var VarTipo = $('#selectorAno').val();
            $.ajaxSetup({
                cache: false
            });
            $.ajax({

                url: "/Indicadores/Estudiantes",
                type: "GET",
                data: { Id: VarTipo, modal:"1" },
                dataType: 'html', //dataType - html
                success: function (result) {
                    //Create a Div around the Partial View and fill the result
                    $('#partialViewContainerDiv').html(result);
                    CargarUbicacionGeografica(VarTipo);
                    CargarRangosEtariosBarras(VarTipo);
                    CargarGrupoEtnico(VarTipo);
                    CargarSexo(VarTipo);
                    if (VarTipo == "1")
                    { $('#txtStatus1').text('Actual'); }
                    else {
                        $('#txtStatus1').text(VarTipo);
                    }

                }
            })
        });
        function CargarRangosEtariosBarras(periodo) {
            var chart = new CanvasJS.Chart("rangoEdadContainer", {
                animationEnabled: true,
                exportFileName: "Rango etarios Chart",
                exportEnabled: true,
                theme: "theme2",
                title: {
                    text: ""
                },
                axisX: {
                    titleFontColor: "black",
                    labelFontColor: "black",
                    labelFontFamily: "Droid-Sans, sans-serif",
                    labelFontSize: "16",
                    labelFontWeight: "Bold"


                },
                axisY: {
                    title: "Cantidad de estudiantes",
                    titleFontColor: "black",
                    titleFontSize: "18",
                    titleFontFamily: "Droid-Sans, sans-serif",
                    lineColor: "#4C2C54",
                    labelFontFamily: "Droid-Sans, sans-serif",
                    labelFontColor: "#4C2C54",
                    tickColor: "#4F81BC",
                    labelFontSize: "14",
                    interlacedColor: "#e6e6e6",
                    gridColor: "#e3e3e3",
                    interval: 10000,
                },
                toolTip: {
                    shared: true,
                    content: toolTipFormatter
                },
                legend: {
                    cursor: "pointer",
                    itemclick: toggleDataSeries,
                    verticalAlign: "bottom",
                    horizontalAlign: "center",
                    fontSize: 20,
                    fontFamily: "Droid-Sans, sans-serif",
                    fontColor: "black"
                },
                data: [{
                    type: "stackedBar",
                    name: "Pública",
                    showInLegend: "true",
                    dataPoints: $.parseJSON(GraficaEstudiantesRangosEtarios(periodo, "PUBLICA"))
                },
                {
                    type: "stackedBar",
                    name: "Privada",
                    showInLegend: "true",
                    dataPoints: $.parseJSON(GraficaEstudiantesRangosEtarios(periodo, "PRIVADA"))
                },
                {
                    type: "stackedBar",
                    name: "Mixta",
                    showInLegend: "true",
                    dataPoints: $.parseJSON(GraficaEstudiantesRangosEtarios(periodo, "MIXTA"))
                }]


            });
            chart.render();
        }

        function CargarUbicacionGeografica(periodo) {
            var chart = new CanvasJS.Chart("ubicacionContainer", {
                animationEnabled: true,
                exportFileName: "Ubicación territorial Chart",
                exportEnabled: true,
                theme: "theme1",
                title: {
                    text: ""
                },
                axisX: {
                    title: "Naturaleza",
                    titleFontColor: "black",
                    titleFontFamily: "Droid-Sans, sans-serif",
                    labelFontColor: "black",
                    labelFontFamily: "Droid-Sans, sans-serif",
                    labelFontSize: "16",
                    labelFontWeight: "Bold"


                },
                axisY: {
                    title: "Cantidad estudiantes",
                    titleFontColor: "black",
                    titleFontFamily: "Droid-Sans, sans-serif",
                    titleFontSize: "18",
                    lineColor: "#4C2C54",
                    labelFontColor: "black",
                    tickColor: "#4F81BC",
                    interlacedColor: "#e6e6e6",
                    gridColor: "#e3e3e3"
                },

                toolTip: {
                    shared: true,
                    content: toolTipFormatter
                },
                legend: {
                    verticalAlign: "top",
                    horizontalAlign: "left",
                    fontSize: 20,
                    fontFamily: "Droid-Sans, sans-serif",
                    fontColor: "black",

                },
                data: [{
                    type: "column",
                    name: "Urbana",
                    legendText: "Urbana",
                    showInLegend: true,
                    dataPoints: $.parseJSON(GraficaEstudiantesUrbano(periodo))
                },
                {
                    type: "column",
                    name: "Rural",
                    legendText: "Rural",
                    showInLegend: true,
                    dataPoints: $.parseJSON(GraficaEstudiantesRural(periodo))
                }
                ]
            });
            chart.render();
        }

        function CargarSexo(periodo) {
            var chart = new CanvasJS.Chart("sexoContainer", {
                animationEnabled: true,
                exportFileName: "Ubicación territorial Chart",
                exportEnabled: true,
                theme: "theme1",
                title: {
                    text: ""
                },
                axisX: {
                    title: "Naturaleza",
                    titleFontColor: "black",
                    titleFontFamily: "Droid-Sans, sans-serif",
                    labelFontColor: "black",
                    labelFontSize: "16",
                    labelFontWeight: "Bold"


                },
                axisY: {
                    title: "Cantidad estudiantes",
                    titleFontColor: "black",
                    titleFontFamily: "Droid-Sans, sans-serif",
                    titleFontSize: "18",
                    lineColor: "#4C2C54",
                    labelFontColor: "black",
                    tickColor: "#4F81BC",
                    interlacedColor: "#e6e6e6",
                    gridColor: "#e3e3e3"
                },

                toolTip: {
                    shared: true,
                    content: toolTipFormatter
                },
                legend: {
                    verticalAlign: "top",
                    horizontalAlign: "left",
                    fontSize: 20,
                    fontFamily: "Droid-Sans, sans-serif",
                    fontColor: "black",

                },
                data: [{
                    type: "column",
                    name: "Femenino",
                    legendText: "Femenino",
                    showInLegend: true,
                    dataPoints: $.parseJSON(GraficaEstudiantesFemenino(periodo))
                },
                {
                    type: "column",
                    name: "Masculino",
                    legendText: "Masculino",
                    showInLegend: true,
                    dataPoints: $.parseJSON(GraficaEstudiantesMasculino(periodo))
                }
                ]
            });
            chart.render();
        }

        function CargarGrupoEtnico(periodo) {
            var chart = new CanvasJS.Chart("grupoEtnicoContainer", {
                animationEnabled: true,
                exportFileName: "Grupo étnico Chart",
                exportEnabled: true,
                theme: "theme2",
                title: {
                    text: ""
                },
                axisX: {
                    titleFontColor: "black",
                    labelFontColor: "black",
                    labelFontFamily: "Droid-Sans, sans-serif",
                    labelFontSize: "16",
                    labelFontWeight: "Bold"

                },
                axisY: {
                    title: "Cantidad de estudiantes",
                    titleFontColor: "black",
                    titleFontSize: "18",
                    titleFontFamily: "Droid-Sans, sans-serif",
                    lineColor: "#4C2C54",
                    labelFontFamily: "Droid-Sans, sans-serif",
                    labelFontColor: "#4C2C54",
                    tickColor: "#4F81BC",
                    labelFontSize: "14",
                    interlacedColor: "#e6e6e6",
                    gridColor: "#e3e3e3",
                    interval: 1000,
                },
                toolTip: {
                    shared: true,
                    content: toolTipFormatter
                },
                legend: {
                    cursor: "pointer",
                    itemclick: toggleDataSeries,
                    verticalAlign: "bottom",
                    horizontalAlign: "center",
                    fontSize: 18,
                    fontFamily: "Droid-Sans, sans-serif",
                    fontColor: "black"
                },
                data: [{
                    type: "stackedBar",
                    name: "Pública",
                    showInLegend: "true",
                    dataPoints: $.parseJSON(GraficaEstudiantesGrupoEtnico(periodo, "PUBLICA"))
                },
                {
                    type: "stackedBar",
                    name: "Privada",
                    showInLegend: "true",

                    dataPoints: $.parseJSON(GraficaEstudiantesGrupoEtnico(periodo, "PRIVADA"))
                },
                {
                    type: "stackedBar",
                    name: "Mixta",
                    showInLegend: "true",

                    dataPoints: $.parseJSON(GraficaEstudiantesGrupoEtnico(periodo, "MIXTA"))
                }]


            });
            chart.render();
        }
        function toolTipFormatter(e) {
            var str = "";
            var total = 0;
            var str3;
            var str2;
            for (var i = 0; i < e.entries.length; i++) {
                var str1 = "<span style= \"color:" + e.entries[i].dataSeries.color + "\">" + e.entries[i].dataSeries.name + "</span>: <strong>" + e.entries[i].dataPoint.y + "</strong> <br/>";
                total = e.entries[i].dataPoint.y + total;
                str = str.concat(str1);
            }
            str2 = "<strong>" + e.entries[0].dataPoint.label + "</strong> <br/>";
            str3 = "<span style = \"color:Tomato\">Total: </span><strong>" + total + "</strong><br/>";
            return (str2.concat(str)).concat(str3);
        }
        function toggleDataSeries(e) {
            if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                e.dataSeries.visible = false;
            }
            else {
                e.dataSeries.visible = true;
            }
            chart.render();
        }
        function GraficaEstudiantesRangosEtarios(valorAno, varSi) {
            var resultado = "";
            var url = '@Url.Action("ObtenerEstudiantesPorRangosEtarios", "Indicadores")';
            $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                async: false,
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ Id: valorAno, si: varSi }),
                success: function (result) {

                    resultado = result;
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

            return resultado;
        }

        function GraficaEstudiantesUbicacion(valorAno, varSi) {
            var resultado = "";
            var url = '@Url.Action("ObtenerEstudiantesPorUbicacion", "Indicadores")';
            $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                async: false,
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ Id: valorAno, si: varSi }),
                success: function (result) {

                    resultado = result;
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

            return resultado;
        }

        function GraficaEstudiantesSexo(valorAno, varSi) {
            var resultado = "";
            var url = '@Url.Action("ObtenerEstudiantesPorSexo", "Indicadores")';
            $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                async: false,
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ Id: valorAno, si: varSi }),
                success: function (result) {

                    resultado = result;
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

            return resultado;
        }

        function GraficaEstudiantesGrupoEtnico(valorAno, varSi) {
            var resultado = "";
            var url = '@Url.Action("ObtenerEstudiantesPorGrupoEtnico", "Indicadores")';
            $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                async: false,
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ Id: valorAno, si: varSi }),
                success: function (result) {

                    resultado = result;
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

            return resultado;
        }

        function GraficaEstudiantesRural(valorAno) {
            var resultado = "";
            var url = '@Url.Action("ObtenerEstudiantesPorUbicacionRural", "Indicadores")';
            $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                async: false,
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ Id: valorAno }),
                success: function (result) {

                    resultado = result;
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

            return resultado;
        }

        function GraficaEstudiantesUrbano(valorAno) {
            var resultado = "";
            var url = '@Url.Action("ObtenerEstudiantesPorUbicacionUrbana", "Indicadores")';
            $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                async: false,
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ Id: valorAno }),
                success: function (result) {

                    resultado = result;
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

            return resultado;
        }

        function GraficaEstudiantesMasculino(valorAno) {
            var resultado = "";
            var url = '@Url.Action("ObtenerEstudiantesPorSexoMasculino", "Indicadores")';
            $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                async: false,
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ Id: valorAno }),
                success: function (result) {

                    resultado = result;
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

            return resultado;
        }

        function GraficaEstudiantesFemenino(valorAno) {
            var resultado = "";
            var url = '@Url.Action("ObtenerEstudiantesPorSexoFemenino", "Indicadores")';
            $.ajax({
                type: 'POST',
                url: url,
                dataType: 'json',
                async: false,
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ Id: valorAno }),
                success: function (result) {

                    resultado = result;
                },
                error: function (xhr, status, error) {
                    alert(error);
                }
            });

            return resultado;
        }
    </script>
    <script type="text/javascript">

        $(function () {

            $('#hRangos').click(function () {
                $('html, body').animate({
                    scrollTop: 500
                },
                    1500);
                return false;
            });

            $('#hUbicacion').click(function () {
                $('html, body').animate({
                    scrollTop: 1000
                },
                    1500);
                return false;
            });
            $('#hGrupo').click(function () {
                $('html, body').animate({
                    scrollTop: 2100
                },
                    1500);
                return false;
            });
            $('#hSexo').click(function () {
                $('html, body').animate({
                    scrollTop: 2700
                },
                    1500);
                return false;
            });


            $('.arriba').click(function () {
                $('html, body').animate({
                    scrollTop: '0px'
                },
                    1500);
                return false;
            });
        });
    </script>

}




